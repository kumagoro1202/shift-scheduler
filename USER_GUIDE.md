# シフト管理システム 利用ガイド

## 📋 目次

1. [はじめに](#はじめに)
2. [システム起動](#システム起動)
3. [基本的な使い方](#基本的な使い方)
4. [機能詳細](#機能詳細)
5. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

### システム概要

このシステムは、小規模施設（5名程度）向けのシフト管理システムです。
職員のスキルスコアを考慮し、各時間帯のスキルバランスを最適化したシフト表を自動生成します。

### 主な機能

- ✅ 職員情報管理（名前、スキルスコア、メールアドレス）
- ✅ 時間帯設定（早番、日勤、遅番など）
- ✅ 勤務可能情報の登録
- ✅ 自動シフト最適化
- ✅ シフト表示・編集
- ✅ Excel出力

### 必要な環境

- **OS**: Windows 10/11（実行可能ファイル版）
- **ブラウザ**: Chrome, Edge, Firefox など

---

## システム起動

### 方法1: 実行可能ファイル版（推奨）

1. `shift_system.exe` をダブルクリック
2. 自動的にブラウザが起動します
3. ブラウザに管理画面が表示されます

> **注意**: 初回起動時は、Windowsのセキュリティ警告が表示される場合があります。
> 「詳細情報」→「実行」をクリックしてください。

### 方法2: Python環境から起動

```powershell
# 依存関係のインストール（初回のみ）
pip install -r requirements.txt

# アプリケーション起動
streamlit run main.py
```

### 終了方法

- **実行ファイル版**: ブラウザを閉じた後、コマンドプロンプトウィンドウで `Ctrl+C`
- **Python版**: ターミナルで `Ctrl+C`

---

## 基本的な使い方

### 初期セットアップ（初回のみ）

#### ステップ1: サンプルデータの投入（オプション）

テスト用のサンプルデータを使う場合:

```powershell
python init_sample_data.py
```

これにより以下が自動登録されます:
- 5名の職員（スキルスコア 70-90）
- 4つの時間帯（早番、日勤、遅番、夜勤）
- 今月と来月の勤務可能情報

#### ステップ2: 職員登録

1. 左サイドバーから「👥 職員管理」をクリック
2. 「新規登録」タブを選択
3. 以下を入力:
   - 氏名（例: 田中 太郎）
   - スキルスコア（1-100、例: 85）
   - メールアドレス（例: tanaka@example.com）
4. 「登録」ボタンをクリック

**スキルスコアの目安:**
- 100: エキスパート
- 80-90: ベテラン
- 60-79: 中堅
- 40-59: 新人
- 1-39: 研修中

#### ステップ3: 時間帯設定

1. 左サイドバーから「⏰ 時間帯設定」をクリック
2. 「新規登録」タブを選択
3. 以下を入力:
   - 時間帯名（例: 早番）
   - 開始時刻（例: 08:00）
   - 終了時刻（例: 16:00）
   - 必要人数（例: 2）
4. 「登録」ボタンをクリック

**時間帯設定例:**
| 時間帯名 | 開始 | 終了 | 必要人数 |
|---------|------|------|---------|
| 早番 | 08:00 | 16:00 | 2 |
| 日勤 | 09:00 | 17:00 | 3 |
| 遅番 | 12:00 | 20:00 | 2 |
| 夜勤 | 20:00 | 08:00 | 1 |

#### ステップ4: 勤務可能情報の登録

1. 左サイドバーから「📅 勤務可能情報」をクリック
2. 年月を選択
3. 職員を選択
4. カレンダーから勤務可能日にチェック
5. 「保存」ボタンをクリック

**一括設定機能:**
- 「すべて勤務可能にする」: その月の全日程を勤務可能に設定
- 「すべて勤務不可にする」: その月の全日程を勤務不可に設定

---

## 機能詳細

### 1. 職員管理（👥）

#### 職員一覧
- 登録済み職員の一覧表示
- スキルスコアを視覚的に確認（プログレスバー）

#### 新規登録
- 氏名、スキルスコア、メールアドレスを入力

#### 編集
1. 編集したい職員を選択
2. 項目を修正
3. 「更新」ボタンをクリック

#### 削除
1. 削除したい職員を選択
2. 「削除」ボタンをクリック
3. 確認ダイアログで「OK」

> **注意**: 職員を削除すると、その職員の勤務可能情報やシフトも削除されます

### 2. 時間帯設定（⏰）

#### 時間帯一覧
- 登録済み時間帯の表示
- 開始時刻、終了時刻、必要人数を確認

#### 新規登録
- 時間帯名、開始時刻、終了時刻、必要人数を入力

#### 編集・削除
- 職員管理と同様の操作

### 3. 勤務可能情報（📅）

#### カレンダー表示
- 月単位でのカレンダー表示
- 勤務可能日は緑色のチェックマーク
- 勤務不可日は赤色のバツマーク

#### 個別設定
- 日付ごとにチェックボックスで設定

#### 一括設定
- 全日を勤務可能/不可に一括変更

### 4. シフト生成（🎯）

#### 生成手順

1. 対象期間を選択
   - **月単位**: 年月を選択
   - **カスタム**: 開始日と終了日を指定

2. 最適化パラメータを確認
   - スキルバランス重視度（デフォルト: 1.0）
   - タイムアウト時間（デフォルト: 60秒）

3. 「シフトを生成」ボタンをクリック

4. 結果を確認
   - 生成されたシフト数
   - スキルバランススコア
   - 警告やエラーメッセージ

#### 最適化の仕組み

システムは以下を最適化します:
- ✅ 各時間帯の必要人数を満たす
- ✅ 職員の勤務可能日を考慮
- ✅ 1人1日1シフトの制約
- ✅ 各時間帯のスキル合計を均等化

**バランススコアの見方:**
- 10未満: 非常に良好 🌟
- 10-20: 良好 ✨
- 20以上: 要改善 ⚠️

### 5. シフト表示（📋）

#### カレンダー表示

- 日付ごとにシフトを表示
- 各時間帯の担当職員とスキルスコアを確認
- 時間帯ごとのスキル合計・平均を表示

#### シフトの削除

1. カレンダー表示で該当シフトの「🗑️」ボタンをクリック
2. 確認後、削除実行

#### 統計・分析

**職員別勤務日数:**
- 各職員の勤務日数を棒グラフで表示
- 勤務の偏りをチェック

**時間帯別スキル分布:**
- 日別・時間帯別のスキル合計推移
- 時間帯ごとの平均値

**全体統計:**
- 総シフト数
- 平均スキル
- スキル標準偏差
- バランススコア

#### Excelエクスポート

1. 「エクスポート」タブを選択
2. 「Excelファイルとしてエクスポート」ボタンをクリック
3. 「ダウンロード」ボタンでファイル取得

**出力ファイル:**
- ファイル名: `shift_YYYYMM.xlsx`
- 保存場所: `exports/` フォルダ
- 内容: 日付、時間帯、職員名、スキルスコア

---

## ワークフロー例

### 月次シフト作成の流れ

#### 1ヶ月目（初回セットアップ）

1. **職員登録**（5分）
   - 全職員の情報を登録

2. **時間帯設定**（3分）
   - 施設の勤務体系に合わせて設定

3. **勤務可能情報入力**（10分）
   - 来月分の勤務可能日を各職員ごとに入力

4. **シフト生成**（1分）
   - 対象月を選択して生成

5. **確認・調整**（5分）
   - 生成されたシフトを確認
   - 必要に応じて手動調整（削除・再生成）

6. **Excel出力**（1分）
   - 印刷・配布用にエクスポート

**所要時間: 約25分**

#### 2ヶ月目以降（運用フェーズ）

1. **勤務可能情報更新**（5分）
   - 翌月分の勤務可能日を入力

2. **シフト生成**（1分）

3. **確認・調整**（3分）

4. **Excel出力**（1分）

**所要時間: 約10分**

---

## トラブルシューティング

### Q1: シフトが生成できない

**原因と対策:**

❌ **職員が登録されていない**
- → 「職員管理」で職員を登録

❌ **時間帯が設定されていない**
- → 「時間帯設定」で時間帯を追加

❌ **勤務可能情報が不足**
- → 「勤務可能情報」で勤務可能日を設定
- → 必要人数に対して勤務可能な職員が少ない可能性

❌ **最適化に失敗**
- → 制約が厳しすぎる可能性
- → 必要人数を減らすか、勤務可能日を増やす

### Q2: バランススコアが高い（20以上）

**改善方法:**

1. **スキルスコアの見直し**
   - 極端な差がないか確認
   - 適切な範囲（60-90）に調整

2. **勤務可能情報の調整**
   - 高スキル職員の勤務可能日を増やす
   - 低スキル職員の偏りを減らす

3. **時間帯の見直し**
   - 必要人数を調整
   - 時間帯の数を減らす

### Q3: アプリケーションが起動しない

**チェック項目:**

□ ポート8501が使用されていないか確認
  ```powershell
  netstat -ano | findstr :8501
  ```

□ 別のStreamlitアプリが起動していないか

□ ファイアウォール設定を確認

□ `shift.db` ファイルの権限を確認

### Q4: データが消えた

**データの保存場所:**
- データベース: `shift.db`
- Excelファイル: `exports/` フォルダ

**バックアップ方法:**
```powershell
# データベースをバックアップ
Copy-Item shift.db shift_backup_$(Get-Date -Format 'yyyyMMdd').db
```

### Q5: Excel出力ができない

**対処法:**

1. `exports/` フォルダの書き込み権限を確認
2. 同名ファイルが開かれていないか確認
3. エラーメッセージを確認

---

## 便利な Tips

### 💡 Tip 1: 勤務可能情報の効率的な入力

月初に一括設定してから、休み希望日だけ個別に外す方法が効率的です:

1. 「すべて勤務可能にする」をクリック
2. 休み希望日のチェックを外す
3. 保存

### 💡 Tip 2: スキルバランスの調整

生成されたシフトのバランスが悪い場合:

1. 統計・分析タブで偏りを確認
2. 特定の職員に偏っている場合は、その職員のスキルスコアを調整
3. 再度シフト生成

### 💡 Tip 3: 定期的なバックアップ

月末にデータベースをバックアップする習慣をつけましょう:

```powershell
# バックアップスクリプト例
Copy-Item shift.db "backup\shift_$(Get-Date -Format 'yyyy年MM月').db"
```

### 💡 Tip 4: 複数月の一括生成

複数月分を一度に生成したい場合:

1. 勤務可能情報を複数月分入力
2. シフト生成でカスタム期間を選択
3. 長期間を指定して生成

### 💡 Tip 5: ブラウザのブックマーク

頻繁に使うページをブックマーク:
- `http://localhost:8501` (ホーム)
- `http://localhost:8501/職員管理`
- `http://localhost:8501/シフト生成`

---

## サポート情報

### システム要件

- **OS**: Windows 10/11
- **メモリ**: 2GB以上推奨
- **ディスク**: 100MB以上の空き容量
- **ブラウザ**: 最新版のChrome/Edge/Firefox

### データ仕様

- **データベース**: SQLite 3.x
- **文字エンコーディング**: UTF-8
- **日付形式**: YYYY-MM-DD
- **時刻形式**: HH:MM (24時間表記)

### ファイル構成

```
shift_system/
├── shift_system.exe      # 実行ファイル
├── shift.db              # データベース（自動生成）
├── exports/              # Excel出力先
│   └── shift_YYYYMM.xlsx
└── USER_GUIDE.md         # 本ガイド
```

---

## 更新履歴

### Version 1.0.0 (2025-11-26)

- ✨ 初回リリース
- 職員管理機能
- 時間帯設定機能
- 勤務可能情報管理
- シフト自動最適化
- シフト表示・編集
- Excel出力機能

---

## お問い合わせ

システムに関するご質問やご要望がございましたら、
システム管理者までお問い合わせください。

**良いシフト作成を！** ✨
