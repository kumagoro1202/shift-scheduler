# シフト作成プログラム - 実装計画（小規模施設版）

## 実装状況（2025年11月26日時点）

✅ **完了項目:**
- 基盤構築とデータ管理機能（Phase 1）完了
- 最適化エンジンとシフト生成機能（Phase 2）完了
- シフト表示・編集機能（Phase 3）完了
- 実行可能ファイル（.exe）のビルド完了

📦 **配布可能な成果物:**
- `dist/shift_system/shift_system.exe` (約21.8MB)
- ユーザーガイド (USER_GUIDE.md)
- サンプルデータ投入スクリプト (init_sample_data.py)

---

## 対象

- **施設規模**: 5名程度の職員
- **動作環境**: ローカルPC（サーバー不要）
- **機能範囲**: 必須機能実装済み

## 実装完了フェーズ

## ✅ Phase 1: 基盤構築とデータ管理（完了）

### 1.1 プロジェクト構築
- [x] Pythonプロジェクト作成
- [x] 依存パッケージ管理（requirements.txt）
- [x] フォルダ構造の作成

### 1.2 データベース構築
- [x] SQLite接続設定
- [x] テーブル作成スクリプト
  - employees（職員）
  - time_slots（時間帯）
  - shifts（シフト）
  - availability（勤務可能情報）
- [x] 初期データ投入スクリプト (init_sample_data.py)

### 1.3 Streamlit基礎
- [x] Streamlitアプリ初期化
- [x] マルチページ構成の設定
- [x] ホーム画面の作成 (main.py)
- [x] ナビゲーションメニュー

### 1.4 基本CRUD機能
**職員管理:**
- [x] 職員一覧表示
- [x] 職員追加フォーム
- [x] 職員編集機能
- [x] 職員削除機能
- [x] スキルスコア入力（1-100）

**時間帯管理:**
- [x] 時間帯一覧表示
- [x] 時間帯追加フォーム
- [x] 時間帯編集・削除

### 成果物 ✅
- 動作するStreamlitアプリ
- SQLiteデータベース (shift.db)
- 職員・時間帯の管理機能

---

## ✅ Phase 2: 最適化エンジンとシフト生成（完了）

### 2.1 勤務可能情報管理
- [x] カレンダー形式の入力UI
- [x] 職員別の可能情報登録
- [x] 月単位での表示・編集
- [x] 一括設定機能（全員可能など）

### 2.2 最適化エンジン実装
- [x] PuLP インストールと設定
- [x] 最適化アルゴリズム実装 (src/optimizer.py)
  - 目的関数: スキルスコア均等化
  - 制約1: 必要人数
  - 制約2: 勤務可能時間
  - 制約3: 1人1日1シフト
- [x] ソルバー実行処理
- [x] 最適化失敗時の処理

### 2.3 シフト生成UI
- [x] 生成パラメータ設定画面
  - 対象期間選択（開始日・終了日）
  - 目標平均スキルスコア
- [x] 生成実行ボタン
- [x] 進捗表示
- [x] 生成結果のプレビュー

### 2.4 テスト
- [x] 5名のサンプルデータでテスト
- [x] 1ヶ月分のシフト生成テスト
- [x] 制約違反チェック

### 成果物 ✅
- 動作する最適化エンジン
- シフト自動生成機能
- 勤務可能情報管理

---

## ✅ Phase 3: シフト表示・編集と仕上げ（完了）

### 3.1 シフト表示機能
- [x] 月別カレンダー表示
- [x] 日別ビュー
- [x] 時間帯ごとのスキルスコア表示
- [x] スキル分布グラフ（plotly）

### 3.2 シフト編集機能
- [x] 手動での職員変更
- [x] シフト追加・削除
- [x] スキルスコアのリアルタイム計算
- [x] 制約違反の警告表示

### 3.3 データ出力機能
- [x] Excel形式でエクスポート
- [x] 印刷レイアウト
- [x] 月別シフト表

### 3.4 ダッシュボード
- [x] 今月のシフト概要
- [x] 職員別勤務日数
- [x] 時間帯別平均スキルスコア
- [x] グラフ表示

### 3.5 仕上げ
- [x] エラーハンドリング
- [x] ユーザーメッセージの改善
- [x] ヘルプ・使い方ガイド (USER_GUIDE.md)
- [ ] データバックアップ機能
- [ ] 設定画面（基本設定）

### 3.6 実行ファイル化
- [x] PyInstallerの設定 (build.spec)
- [x] .exeファイルの作成（Windows）
- [x] 動作確認
- [x] 配布パッケージ作成

### 成果物 ✅
- 完成したシフト管理アプリ
- 実行ファイル（shift_system.exe）
- ユーザーマニュアル (USER_GUIDE.md)

---

## 🎯 Phase 4: 今後の改善予定（オプション）

### 4.1 高度な機能
- [ ] データバックアップ・リストア機能
- [ ] システム設定画面
- [ ] 詳細なログ記録
- [ ] パフォーマンス最適化

### 4.2 ユーザビリティ向上
- [ ] ダークモード対応
- [ ] キーボードショートカット
- [ ] より詳細なヘルプドキュメント
- [ ] チュートリアルモード

### 4.3 分析機能の強化
- [ ] 月次レポート機能
- [ ] 職員別の勤務傾向分析
- [ ] スキルバランスの長期トレンド
- [ ] PDF形式でのレポート出力

### 4.4 その他
- [ ] マルチユーザー対応
- [ ] クラウド同期機能
- [ ] モバイル対応版
- [ ] 他システムとの連携API

---

## プロジェクト構造（現在）

```
shift-scheduler/
├── main.py                 # メインエントリーポイント ✅
├── requirements.txt        # 依存パッケージ ✅
├── build.spec             # PyInstallerビルド設定 ✅
├── run.bat                # 起動用バッチファイル ✅
├── init_sample_data.py    # サンプルデータ投入 ✅
├── README.md              # プロジェクト概要 ✅
├── USER_GUIDE.md          # ユーザーガイド ✅
├── ARCHITECTURE.md        # システム設計書 ✅
├── IMPLEMENTATION_PLAN.md # 実装計画（本ファイル） ✅
├── pages/                 # Streamlitページ ✅
│   ├── 1_👥_職員管理.py
│   ├── 2_⏰_時間帯設定.py
│   ├── 3_📅_勤務可能情報.py
│   ├── 4_🎯_シフト生成.py
│   └── 5_📋_シフト表示.py
├── src/                   # ソースコード ✅
│   ├── database.py        # DB接続・操作
│   ├── optimizer.py       # 最適化エンジン
│   └── utils.py           # ユーティリティ
├── dist/                  # ビルド成果物 ✅
│   └── shift_system/
│       ├── shift_system.exe
│       └── _internal/
├── build/                 # ビルド一時ファイル
├── shift.db              # SQLiteデータベース（自動生成）
└── exports/              # Excel出力先（自動生成）
```

---

## 技術スタック（実装済み）

### バックエンド
- **言語**: Python 3.14
- **データベース**: SQLite 3.x
- **最適化**: PuLP 3.3.0
- **依存パッケージ**:
  - streamlit >= 1.28.0
  - pandas >= 2.0.0
  - pulp >= 2.7.0
  - openpyxl >= 3.1.0
  - plotly >= 5.17.0
  - python-dateutil >= 2.8.2

### フロントエンド
- **フレームワーク**: Streamlit 1.50.0
- **可視化**: Plotly 6.5.0

### ビルド・配布
- **パッケージング**: PyInstaller 6.17.0
- **出力形式**: Windows実行ファイル (.exe)

---

## 実装完了機能一覧

### ✅ データ管理
- 職員マスタ（CRUD）
- 時間帯マスタ（CRUD）
- 勤務可能情報管理
- SQLiteデータベース

### ✅ シフト生成
- 最適化アルゴリズム（PuLP）
- スキルスコア均等化
- 必要人数制約
- 勤務可能時間制約
- 1人1日1シフト制約

### ✅ シフト管理
- カレンダー表示
- 日別・週別・月別ビュー
- 手動編集機能
- スキルスコア表示
- 制約違反チェック

### ✅ 分析・レポート
- スキル分布グラフ
- 職員別勤務日数集計
- 時間帯別スキル統計
- Excel形式エクスポート

### ✅ ユーザビリティ
- 直感的なUI
- サンプルデータ投入機能
- ユーザーガイド
- エラーハンドリング

### ✅ 配布
- Windows実行ファイル (.exe)
- スタンドアロン動作
- インストール不要

---

## 開発環境

### 必要なソフトウェア
- Python 3.11以上
- pip（パッケージ管理）
- テキストエディタ（VS Code推奨）

### 依存パッケージ（requirements.txt）

```txt
streamlit==1.28.0
pandas==2.1.0
pulp==2.7.0
openpyxl==3.1.0
plotly==5.17.0
python-dateutil==2.8.2
```

---

## 使用方法

### 開発モードでの実行
```powershell
# 依存パッケージのインストール
pip install -r requirements.txt

# アプリケーションの起動
streamlit run main.py
```

または、`run.bat` をダブルクリック

### 実行ファイルでの起動
```
dist/shift_system/shift_system.exe
```
をダブルクリック

---

## システム要件

- **OS**: Windows 10/11
- **メモリ**: 2GB以上推奨
- **ディスク**: 100MB以上の空き容量
- **ブラウザ**: Chrome, Edge, Firefox など

---

## 今後の改善候補

### 優先度: 中
- データバックアップ・リストア機能
- システム設定画面（詳細設定）
- より詳細なログ記録

### 優先度: 低
- ダークモード対応
- PDF形式でのレポート出力
- マルチユーザー対応
- クラウド同期機能

---

## プロジェクト完了サマリー

**開発期間**: 2025年11月（約3週間）  
**実装機能**: 全必須機能完了  
**配布形式**: Windows実行ファイル (.exe)  
**ドキュメント**: ユーザーガイド、システム設計書完備

**リリース状態**: ✅ 本番利用可能
