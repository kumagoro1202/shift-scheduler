# ã‚·ãƒ•ãƒˆè¡¨ç¤ºç”»é¢ è©³ç´°è¨­è¨ˆæ›¸

## 1. ç”»é¢æ¦‚è¦

### 1.1 ç›®çš„
ç”Ÿæˆã•ã‚ŒãŸã‚·ãƒ•ãƒˆã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å½¢å¼ã§è¡¨ç¤ºã—ã€ä¼‘æ†©æ™‚é–“ã®ç®¡ç†ã€çµ±è¨ˆåˆ†æã€ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’è¡Œã†ç”»é¢ã€‚

### 1.2 ç”»é¢ãƒ‘ã‚¹
- **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `pages/4_ğŸ“‹_ã‚·ãƒ•ãƒˆè¡¨ç¤º.py`
- **URL**: `/4_ğŸ“‹_ã‚·ãƒ•ãƒˆè¡¨ç¤º`ï¼ˆStreamlitã®ãƒšãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰

### 1.3 ç”»é¢æ§‹æˆ
- å¹´æœˆé¸æŠã‚¨ãƒªã‚¢ï¼ˆçŸ¢å°ãƒœã‚¿ãƒ³ + ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼‰
- ã‚¿ãƒ–1: ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
- ã‚¿ãƒ–2: â˜• ä¼‘æ†©æ™‚é–“
- ã‚¿ãƒ–3: ğŸ“Š çµ±è¨ˆãƒ»åˆ†æ
- ã‚¿ãƒ–4: ğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- ã‚µã‚¤ãƒ‰ãƒãƒ¼: ãƒ˜ãƒ«ãƒ—æƒ…å ±

### 1.4 è¨­è¨ˆæ€æƒ³
- **è¦–è¦šçš„ãªã‚·ãƒ•ãƒˆç¢ºèª**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å½¢å¼ã§ã®ç›´æ„Ÿçš„ãªè¡¨ç¤º
- **ä¼‘æ†©æ™‚é–“ç®¡ç†**: å—ä»˜çª“å£ã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¤œè¨¼
- **ãƒ‡ãƒ¼ã‚¿åˆ†æ**: è·å“¡åˆ¥ãƒ»æ™‚é–“å¸¯åˆ¥ã®çµ±è¨ˆæƒ…å ±
- **ãƒ‡ãƒ¼ã‚¿é€£æº**: Excelå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 2.1 Shiftï¼ˆè¡¨ç¤ºç”¨ã‚·ãƒ•ãƒˆï¼‰

list_shifts()ã‹ã‚‰è¿”ã•ã‚Œã‚‹ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆè¾æ›¸å½¢å¼ï¼‰ã€‚

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

| é …ç›®å | å‹ | èª¬æ˜ |
|--------|-----|------|
| id | int | ã‚·ãƒ•ãƒˆID |
| date | str | æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰ |
| time_slot_id | str | æ™‚é–“å¸¯ID |
| employee_id | int | è·å“¡ID |
| employee_name | str | è·å“¡å |
| time_slot_name | str | æ™‚é–“å¸¯è¡¨ç¤ºå |
| start_time | str | é–‹å§‹æ™‚åˆ»ï¼ˆHH:MMï¼‰ |
| end_time | str | çµ‚äº†æ™‚åˆ»ï¼ˆHH:MMï¼‰ |
| skill_score | int | ã‚¹ã‚­ãƒ«ã‚¹ã‚³ã‚¢ |
| employee | dict | è·å“¡æƒ…å ±ï¼ˆè¾æ›¸ï¼‰ |
| time_slot | dict | æ™‚é–“å¸¯æƒ…å ±ï¼ˆè¾æ›¸ï¼‰ |

### 2.2 BreakScheduleï¼ˆä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

| é …ç›®å | å‹ | èª¬æ˜ |
|--------|-----|------|
| id | int | ä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ID |
| shift_id | int | ã‚·ãƒ•ãƒˆID |
| employee_id | int | è·å“¡ID |
| date | str | æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰ |
| break_number | int | ä¼‘æ†©ç•ªå·ï¼ˆ1, 2, ...ï¼‰ |
| break_start_time | str | ä¼‘æ†©é–‹å§‹æ™‚åˆ»ï¼ˆHH:MMï¼‰ |
| break_end_time | str | ä¼‘æ†©çµ‚äº†æ™‚åˆ»ï¼ˆHH:MMï¼‰ |

---

## 3. ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

### 3.1 å¹´æœˆé¸æŠã‚¨ãƒªã‚¢

#### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹æˆ

**4ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆæ¯”ç‡: 1:3:3:1ï¼‰**

| ã‚«ãƒ©ãƒ  | é …ç›® | ã‚¿ã‚¤ãƒ— | æ©Ÿèƒ½ |
|--------|------|--------|------|
| 1 | â—€ | button | å‰æœˆã¸ç§»å‹• |
| 2 | å¹´ | selectbox | å¹´é¸æŠï¼ˆç¾åœ¨å¹´-1ã€œç¾åœ¨å¹´+2ï¼‰ |
| 3 | æœˆ | selectbox | æœˆé¸æŠï¼ˆ1ã€œ12ï¼‰ |
| 4 | â–¶ | button | æ¬¡æœˆã¸ç§»å‹• |

**ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹**:
- `display_year`: é¸æŠä¸­ã®å¹´
- `display_month`: é¸æŠä¸­ã®æœˆ

### 3.2 ã‚¿ãƒ–1: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º

#### 3.2.1 ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢

**3ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆæ¯”ç‡: 2:2:1ï¼‰**

| ã‚«ãƒ©ãƒ  | é …ç›® | ã‚¿ã‚¤ãƒ— | æ©Ÿèƒ½ |
|--------|------|--------|------|
| 1 | æ¥­å‹™ã‚¨ãƒªã‚¢ã§çµã‚Šè¾¼ã¿ | multiselect | ãƒªãƒå®¤ã€å—ä»˜ãªã©ã§çµã‚Šè¾¼ã¿ |
| 2 | ã™ã¹ã¦é–‹ã / ã™ã¹ã¦é–‰ã˜ã‚‹ | button Ã— 2 | ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã®ä¸€æ‹¬é–‹é–‰ |
| 3 | ãƒªã‚»ãƒƒãƒˆ | button | ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ |

**ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹**:
- `expander_state`: ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã®é–‹é–‰çŠ¶æ…‹ï¼ˆboolï¼‰

#### 3.2.2 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º

**é€±å˜ä½ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ7ã‚«ãƒ©ãƒ ï¼‰**

##### ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ

| æœˆ | ç« | æ°´ | æœ¨ | é‡‘ | åœŸ | æ—¥ |
|----|----|----|----|----|----|----|

##### æ—¥ä»˜ã‚»ãƒ«ã®æ§‹æˆ

**HTMLæ§‹é€ **:
```html
<!-- æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div style="background-color: {bg_color}; padding: 5px; border-radius: 5px 5px 0 0; text-align: center;">
    <div style="font-size: 16px; font-weight: bold; color: {text_color};">{æ—¥}</div>
</div>

<!-- ã‚·ãƒ•ãƒˆæƒ…å ± -->
<div style="background-color: white; padding: 5px; border: 1px solid #dee2e6; border-radius: 0 0 5px 5px; min-height: 100px;">
    <!-- ã‚¨ãƒªã‚¢ã”ã¨ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ -->
    <!-- ã‚·ãƒ•ãƒˆæ•°ãƒ»å¹³å‡ã‚¹ã‚­ãƒ« -->
</div>
```

**èƒŒæ™¯è‰²ã®è¨­å®š**:

| æ¡ä»¶ | èƒŒæ™¯è‰² | æ„å‘³ |
|------|--------|------|
| æ—¥æ›œæ—¥ | #2c2c2cï¼ˆæš—ç°è‰²ï¼‰ | å®šä¼‘æ—¥ |
| å¹³å‡ã‚¹ã‚­ãƒ« >= 4.0 | #51cf66ï¼ˆç·‘ï¼‰ | é«˜ã‚¹ã‚­ãƒ« |
| å¹³å‡ã‚¹ã‚­ãƒ« >= 3.0 | #74c0fcï¼ˆé’ï¼‰ | ä¸­ã‚¹ã‚­ãƒ« |
| å¹³å‡ã‚¹ã‚­ãƒ« < 3.0 | #ffa94dï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰ | ä½ã‚¹ã‚­ãƒ« |
| ã‚·ãƒ•ãƒˆãªã— | #868e96ï¼ˆç°è‰²ï¼‰ | æœªå‰²ã‚Šå½“ã¦ |

##### ã‚¨ãƒªã‚¢ã”ã¨ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼

**æ§‹é€ **:
```
ğŸ“ å—ä»˜ (ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼)
  â””â”€ **åˆå‰** (08:30 - 13:00)
      â”œâ”€ ğŸ‘¤ å±±ç”°å¤ªéƒ
      â”‚   â””â”€ ğŸ’ª 150.0
      â”‚   â””â”€ ğŸ—‘ï¸ (å‰Šé™¤ãƒœã‚¿ãƒ³)
      â”œâ”€ ğŸ‘¤ éˆ´æœ¨èŠ±å­
      â”‚   â””â”€ ğŸ’ª 145.0
      â”‚   â””â”€ ğŸ—‘ï¸ (å‰Šé™¤ãƒœã‚¿ãƒ³)
      â””â”€ åˆè¨ˆ: 295.0 / å¹³å‡: 147.5
```

**ã‚¨ãƒªã‚¢ã‚¢ã‚¤ã‚³ãƒ³**:
- ãƒªãƒå®¤: ğŸ¥
- å—ä»˜: ğŸ“
- ãã®ä»–: ğŸ¢

##### ã‚·ãƒ•ãƒˆæ•°ãƒ»ã‚¹ã‚­ãƒ«ãƒ¡ãƒˆãƒªãƒƒã‚¯

| ãƒ¡ãƒˆãƒªãƒƒã‚¯å | è¨ˆç®—å¼ |
|------------|--------|
| ã‚·ãƒ•ãƒˆæ•° | ãã®æ—¥ã®ã‚·ãƒ•ãƒˆä»¶æ•° |
| å¹³å‡ã‚¹ã‚­ãƒ« | ãã®æ—¥ã®ã‚¹ã‚­ãƒ«ã‚¹ã‚³ã‚¢å¹³å‡ |

### 3.3 ã‚¿ãƒ–2: ä¼‘æ†©æ™‚é–“

#### 3.3.1 æ—¥ä»˜é¸æŠãƒ»è‡ªå‹•å‰²ã‚Šå½“ã¦ã‚¨ãƒªã‚¢

**2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆæ¯”ç‡: 2:3ï¼‰**

| ã‚«ãƒ©ãƒ  | é …ç›® | ã‚¿ã‚¤ãƒ— | æ©Ÿèƒ½ |
|--------|------|--------|------|
| 1 | æ—¥ä»˜ã‚’é¸æŠ | selectbox | ã‚·ãƒ•ãƒˆãŒå­˜åœ¨ã™ã‚‹æ—¥ä»˜ã‹ã‚‰é¸æŠ |
| 2 | ä¼‘æ†©æ™‚é–“ã‚’è‡ªå‹•å‰²ã‚Šå½“ã¦ | button | é¸æŠæ—¥ã®ä¼‘æ†©ã‚’è‡ªå‹•å‰²ã‚Šå½“ã¦ |

**æ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: `{YYYY-MM-DD} ({æ›œæ—¥})`

#### 3.3.2 ä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤º

**3ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆæ¯”ç‡: 2:3:2ï¼‰**

| ã‚«ãƒ©ãƒ  | å†…å®¹ |
|--------|------|
| 1 | ğŸ‘¤ {è·å“¡å} |
| 2 | ä¼‘æ†©{ç•ªå·}: {é–‹å§‹} - {çµ‚äº†} |
| 3 | ãƒ¡ãƒˆãƒªãƒƒã‚¯: {æ™‚é–“}åˆ† |

#### 3.3.3 çª“å£ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯

**è¡¨ç¤ºå†…å®¹**:
- å—ä»˜çª“å£ã®å¸¸é§äººæ•°ãƒã‚§ãƒƒã‚¯çµæœ
- æˆåŠŸ: "âœ… å—ä»˜çª“å£ã®å¸¸é§äººæ•°ã¯å¸¸ã«2åä»¥ä¸Šã§ã™"
- å¤±æ•—: "âŒ å—ä»˜çª“å£ã®å¸¸é§äººæ•°ãŒä¸è¶³ã™ã‚‹æ™‚é–“å¸¯ãŒã‚ã‚Šã¾ã™" + è­¦å‘Šãƒªã‚¹ãƒˆ

### 3.4 ã‚¿ãƒ–3: çµ±è¨ˆãƒ»åˆ†æ

#### 3.4.1 è·å“¡åˆ¥å‹¤å‹™æ—¥æ•°

**2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**

| ã‚«ãƒ©ãƒ  | å†…å®¹ |
|--------|------|
| 1 | æ£’ã‚°ãƒ©ãƒ•ï¼ˆPlotlyï¼‰ |
| 2 | ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« |

**ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ©ãƒ **:
- è·å“¡å
- å‹¤å‹™æ—¥æ•°
- ã‚¹ã‚­ãƒ«ã‚¹ã‚³ã‚¢ï¼ˆæœ€åˆã®å€¤ï¼‰

#### 3.4.2 æ™‚é–“å¸¯åˆ¥ã‚¹ã‚­ãƒ«åˆ†å¸ƒ

**2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**

| ã‚«ãƒ©ãƒ  | å†…å®¹ |
|--------|------|
| 1 | æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼ˆæ—¥åˆ¥ãƒ»æ™‚é–“å¸¯åˆ¥ã‚¹ã‚­ãƒ«åˆè¨ˆï¼‰ |
| 2 | ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ™‚é–“å¸¯åˆ¥å¹³å‡ï¼‰ |

**ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ©ãƒ **:
- æ™‚é–“å¸¯
- ã‚¹ã‚­ãƒ«åˆè¨ˆï¼ˆå¹³å‡ï¼‰
- ã‚¹ã‚­ãƒ«å¹³å‡ï¼ˆå¹³å‡ï¼‰
- äººæ•°ï¼ˆå¹³å‡ï¼‰

#### 3.4.3 å…¨ä½“çµ±è¨ˆ

**4ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**

| ã‚«ãƒ©ãƒ  | ãƒ¡ãƒˆãƒªãƒƒã‚¯å | è¨ˆç®—å¼ |
|--------|------------|--------|
| 1 | ç·ã‚·ãƒ•ãƒˆæ•° | len(shifts) |
| 2 | å¹³å‡ã‚¹ã‚­ãƒ« | skill_scoreã®å¹³å‡ |
| 3 | ã‚¹ã‚­ãƒ«æ¨™æº–åå·® | skill_scoreã®æ¨™æº–åå·® |
| 4 | ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢ | æ™‚é–“å¸¯ã”ã¨ã®ã‚¹ã‚­ãƒ«åˆè¨ˆã®æ¨™æº–åå·® |

**è©•ä¾¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:

| æ¡ä»¶ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ã‚¿ã‚¤ãƒ— |
|------|-----------|--------|
| ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢ < 10 | ğŸŒŸ ã‚¹ã‚­ãƒ«ãƒãƒ©ãƒ³ã‚¹ãŒéå¸¸ã«è‰¯å¥½ã§ã™ï¼ | success |
| ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢ < 20 | âœ¨ ã‚¹ã‚­ãƒ«ãƒãƒ©ãƒ³ã‚¹ã¯è‰¯å¥½ã§ã™ | info |
| ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢ >= 20 | âš ï¸ ã‚¹ã‚­ãƒ«ã«ã‚„ã‚„åã‚ŠãŒã‚ã‚Šã¾ã™ | warning |

### 3.5 ã‚¿ãƒ–4: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

#### 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

| ã‚«ãƒ©ãƒ  | å†…å®¹ |
|--------|------|
| 1 | Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ + ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ |
| 2 | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼ã®èª¬æ˜ï¼ˆinfoãƒœãƒƒã‚¯ã‚¹ï¼‰ |

**ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½**:
1. ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
2. `exports/shift_{å¹´æœˆ}.xlsx` ã«ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
3. æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
4. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³è¡¨ç¤º

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 4.1 ç”»é¢åˆæœŸè¡¨ç¤ºãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant UI as Streamlit UI
    participant Session as st.session_state
    participant DB as database.py
    participant Utils as utils.py

    User->>UI: ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹
    UI->>Session: display_year, display_month åˆæœŸåŒ–
    
    UI->>Utils: get_month_range(year, month)
    Utils-->>UI: (start_date, end_date)
    
    UI->>DB: list_shifts(start_date, end_date)
    DB-->>UI: List[dict]
    
    alt ã‚·ãƒ•ãƒˆãªã—
        UI->>UI: st.warning("ã‚·ãƒ•ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“")
        UI->>UI: st.stop()
    end
    
    UI-->>User: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
```

### 4.2 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant UI as Streamlit UI
    participant Pandas as pd.DataFrame

    User->>UI: ã‚¿ãƒ–1é¸æŠ
    UI->>Pandas: ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’DataFrameã«å¤‰æ›
    
    UI->>UI: ã‚¨ãƒªã‚¢åæŠ½å‡ºï¼ˆæ­£è¦è¡¨ç¾ï¼‰
    UI->>UI: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
    
    UI->>UI: æ—¥ä»˜ãƒªã‚¹ãƒˆç”Ÿæˆ
    UI->>UI: é€±å˜ä½ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    
    loop å„é€±
        loop å„æ—¥
            UI->>Pandas: ãã®æ—¥ã®ã‚·ãƒ•ãƒˆæŠ½å‡º
            UI->>UI: èƒŒæ™¯è‰²è¨ˆç®—
            UI->>UI: ã‚¨ãƒªã‚¢ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            UI->>UI: ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
        end
    end
    
    UI-->>User: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºå®Œäº†
```

### 4.3 ã‚·ãƒ•ãƒˆå‰Šé™¤ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant UI as Streamlit UI
    participant DB as database.py

    User->>UI: å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    UI->>DB: delete_shift(shift_id)
    DB-->>UI: å‰Šé™¤æˆåŠŸ/å¤±æ•—ï¼ˆboolï¼‰
    
    alt æˆåŠŸ
        UI->>UI: st.success("å‰Šé™¤")
        UI->>UI: st.rerun()
    end
```

### 4.4 ä¼‘æ†©è‡ªå‹•å‰²ã‚Šå½“ã¦ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant UI as Streamlit UI
    participant Breaks as breaks.py
    participant DB as database.py

    User->>UI: æ—¥ä»˜é¸æŠ
    User->>UI: è‡ªå‹•å‰²ã‚Šå½“ã¦ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    
    UI->>UI: ãã®æ—¥ã®ã‚·ãƒ•ãƒˆæŠ½å‡º
    UI->>Breaks: auto_assign_and_save_breaks(date, shifts)
    
    Breaks->>DB: delete_break_schedules_by_date_range(date, date)
    Breaks->>DB: create_break_schedule() Ã— N
    Breaks->>Breaks: validate_reception_coverage()
    Breaks-->>UI: (saved_count, is_valid, warnings)
    
    alt å‰²ã‚Šå½“ã¦æˆåŠŸ
        UI->>UI: st.success("{ä»¶æ•°}ä»¶ã®ä¼‘æ†©æ™‚é–“ã‚’å‰²ã‚Šå½“ã¦ã¾ã—ãŸ")
    else è­¦å‘Šã‚ã‚Š
        UI->>UI: st.warning(warnings)
    end
    
    UI->>UI: st.rerun()
```

### 4.5 Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant UI as Streamlit UI
    participant Utils as utils.py

    User->>UI: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    UI->>UI: exportsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    UI->>Utils: export_to_excel(shifts, filepath)
    
    Utils->>Utils: DataFrameã«å¤‰æ›
    Utils->>Utils: ã‚«ãƒ©ãƒ æ•´å½¢
    Utils->>Utils: Excelæ›¸ãè¾¼ã¿ï¼ˆopenpyxlï¼‰
    Utils-->>UI: æˆåŠŸ/å¤±æ•—ï¼ˆboolï¼‰
    
    alt æˆåŠŸ
        UI->>UI: st.success("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†")
        UI->>UI: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³è¡¨ç¤º
    else å¤±æ•—
        UI->>UI: st.error("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ")
    end
```

---

## 5. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

### 5.1 ã‚¨ãƒªã‚¢åãƒ»æ™‚é–“å¸¯ã®æŠ½å‡º

```python
# ã‚¨ãƒªã‚¢åã‚’æŠ½å‡ºï¼ˆä¾‹: "ãƒªãƒå®¤ï¼ˆæœˆæ›œåˆå‰ï¼‰" -> "ãƒªãƒå®¤"ï¼‰
df['area'] = df['time_slot_name'].str.extract(r'^([^ï¼ˆ]+)', expand=False)

# æ™‚é–“å¸¯ã‚’æŠ½å‡ºï¼ˆä¾‹: "ãƒªãƒå®¤ï¼ˆæœˆæ›œåˆå‰ï¼‰" -> "åˆå‰"ï¼‰
df['period'] = df['time_slot_name'].str.extract(r'(åˆå‰|åˆå¾Œ)', expand=False)
```

### 5.2 é€±åˆ†å‰²ãƒ­ã‚¸ãƒƒã‚¯

```python
weeks = []
current_week = []

for date_obj in display_dates:
    day_of_week = date_obj.weekday()  # 0=æœˆæ›œ, 6=æ—¥æ›œ
    
    # æœˆæ›œæ—¥ã§é€±ã®é€”ä¸­ãªã‚‰æ–°ã—ã„é€±ã‚’é–‹å§‹
    if day_of_week == 0 and current_week:
        weeks.append(current_week)
        current_week = []
    
    # æœ€åˆã®é€±ã®å ´åˆã€æœˆæ›œæ—¥ã¾ã§ç©ºç™½ã‚’è¿½åŠ 
    if not current_week and len(weeks) == 0:
        for _ in range(day_of_week):
            current_week.append(None)
    
    current_week.append(date_obj)
    
    # æ—¥æ›œæ—¥ã§é€±ã‚’å®Œäº†
    if day_of_week == 6:
        weeks.append(current_week)
        current_week = []

# æœ€å¾Œã®é€±ãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã€æ—¥æ›œæ—¥ã¾ã§ç©ºç™½ã§åŸ‹ã‚ã‚‹
if current_week:
    while len(current_week) < 7:
        current_week.append(None)
    weeks.append(current_week)
```

### 5.3 èƒŒæ™¯è‰²æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯

```python
def get_date_bg_color(day_shifts, is_sunday):
    if is_sunday:
        return "#2c2c2c"  # æš—ç°è‰²
    
    if len(day_shifts) == 0:
        return "#868e96"  # ç°è‰²ï¼ˆã‚·ãƒ•ãƒˆãªã—ï¼‰
    
    avg_skill = day_shifts['skill_score'].mean()
    
    if avg_skill >= 4.0:
        return "#51cf66"  # ç·‘ï¼ˆé«˜ã‚¹ã‚­ãƒ«ï¼‰
    elif avg_skill >= 3.0:
        return "#74c0fc"  # é’ï¼ˆä¸­ã‚¹ã‚­ãƒ«ï¼‰
    else:
        return "#ffa94d"  # ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆä½ã‚¹ã‚­ãƒ«ï¼‰
```

### 5.4 çµ±è¨ˆè¨ˆç®—

#### è·å“¡åˆ¥å‹¤å‹™æ—¥æ•°

```python
employee_counts = df.groupby('employee_name').size().reset_index(name='å‹¤å‹™æ—¥æ•°')
employee_skills = df.groupby('employee_name')['skill_score'].first().reset_index()
employee_stats = employee_counts.merge(employee_skills, on='employee_name')
employee_stats = employee_stats.sort_values('å‹¤å‹™æ—¥æ•°', ascending=False)
```

#### æ™‚é–“å¸¯åˆ¥é›†è¨ˆ

```python
time_slot_stats = df.groupby(['date', 'time_slot_name', 'time_slot_id']).agg({
    'skill_score': ['sum', 'mean', 'count']
}).reset_index()

time_slot_avg = time_slot_stats.groupby('æ™‚é–“å¸¯').agg({
    'ã‚¹ã‚­ãƒ«åˆè¨ˆ': 'mean',
    'ã‚¹ã‚­ãƒ«å¹³å‡': 'mean',
    'äººæ•°': 'mean'
}).reset_index()
```

#### ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢

```python
# å„æ—¥ä»˜ãƒ»æ™‚é–“å¸¯ã®ã‚¹ã‚­ãƒ«åˆè¨ˆã‚’è¨ˆç®—
slot_totals = df.groupby(['date', 'time_slot_id'])['skill_score'].sum()

# æ¨™æº–åå·®ã‚’è¨ˆç®—
balance_score = slot_totals.std()
```

### 5.5 çª“å£ã‚«ãƒãƒ¬ãƒƒã‚¸æ¤œè¨¼

```python
def validate_reception_coverage(date, shifts, break_schedules):
    reception_shifts = [s for s in shifts if s['time_slot']['area'] == "å—ä»˜"]
    
    if not reception_shifts:
        return True, []
    
    warnings = []
    intervals = generate_time_intervals("08:30", "19:00", 15)  # 15åˆ†åˆ»ã¿
    
    for window in intervals:
        working = _count_working_staff(reception_shifts, break_schedules, window)
        if working < 2:
            warnings.append(f"{window[0]}-{window[1]}ã®å—ä»˜å¸¸é§äººæ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™ ({working}å)")
    
    return (len(warnings) == 0), warnings
```

---

## 6. UI/UXã®è©³ç´°

### 6.1 ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ

| ç”¨é€” | ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | è‰²å | æ„å‘³ |
|------|------------|------|------|
| é«˜ã‚¹ã‚­ãƒ« | #51cf66 | ç·‘ | å¹³å‡ã‚¹ã‚­ãƒ« >= 4.0 |
| ä¸­ã‚¹ã‚­ãƒ« | #74c0fc | é’ | å¹³å‡ã‚¹ã‚­ãƒ« >= 3.0 |
| ä½ã‚¹ã‚­ãƒ« | #ffa94d | ã‚ªãƒ¬ãƒ³ã‚¸ | å¹³å‡ã‚¹ã‚­ãƒ« < 3.0 |
| ã‚·ãƒ•ãƒˆãªã— | #868e96 | ç°è‰² | ã‚·ãƒ•ãƒˆæœªå‰²ã‚Šå½“ã¦ |
| å®šä¼‘æ—¥ | #2c2c2c | æš—ç°è‰² | æ—¥æ›œæ—¥ |

### 6.2 ã‚¢ã‚¤ã‚³ãƒ³ã®ä½¿ç”¨

| ã‚¢ã‚¤ã‚³ãƒ³ | æ„å‘³ | ä½¿ç”¨å ´é¢ |
|---------|------|---------|
| ğŸ¥ | ãƒªãƒå®¤ | ã‚¨ãƒªã‚¢åè¡¨ç¤º |
| ğŸ“ | å—ä»˜ | ã‚¨ãƒªã‚¢åè¡¨ç¤º |
| ğŸ¢ | ãã®ä»– | ã‚¨ãƒªã‚¢åè¡¨ç¤º |
| ğŸ‘¤ | è·å“¡ | è·å“¡åã®å‰ |
| ğŸ’ª | ã‚¹ã‚­ãƒ« | ã‚¹ã‚­ãƒ«ã‚¹ã‚³ã‚¢è¡¨ç¤º |
| ğŸ—‘ï¸ | å‰Šé™¤ | å‰Šé™¤ãƒœã‚¿ãƒ³ |
| ğŸŒ™ | å®šä¼‘ | æ—¥æ›œæ—¥ |
| ğŸ“­ | ã‚·ãƒ•ãƒˆãªã— | ã‚·ãƒ•ãƒˆæœªå‰²ã‚Šå½“ã¦æ—¥ |
| â˜• | ä¼‘æ†© | ä¼‘æ†©ã‚¿ãƒ– |

### 6.3 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

#### 6.3.1 æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

| ã‚¿ã‚¤ãƒ— | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|--------|-----------|
| ã‚·ãƒ•ãƒˆè¡¨ç¤º | "âœ… {ä»¶æ•°}ä»¶ã®ã‚·ãƒ•ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™" |
| ä¼‘æ†©å‰²ã‚Šå½“ã¦ | "âœ… {ä»¶æ•°}ä»¶ã®ä¼‘æ†©æ™‚é–“ã‚’å‰²ã‚Šå½“ã¦ã¾ã—ãŸ" |
| ã‚«ãƒãƒ¬ãƒƒã‚¸OK | "âœ… å—ä»˜çª“å£ã®å¸¸é§äººæ•°ã¯å¸¸ã«2åä»¥ä¸Šã§ã™" |
| ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | "âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†: exports/{filename}" |
| ã‚·ãƒ•ãƒˆå‰Šé™¤ | "å‰Šé™¤" |

#### 6.3.2 è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

| ã‚¿ã‚¤ãƒ— | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|--------|-----------|
| ã‚·ãƒ•ãƒˆãªã— | "âš ï¸ ã‚·ãƒ•ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“" |
| ã‚«ãƒãƒ¬ãƒƒã‚¸NG | "âŒ å—ä»˜çª“å£ã®å¸¸é§äººæ•°ãŒä¸è¶³ã™ã‚‹æ™‚é–“å¸¯ãŒã‚ã‚Šã¾ã™" |
| ãƒãƒ©ãƒ³ã‚¹æ‚ª | "âš ï¸ ã‚¹ã‚­ãƒ«ã«ã‚„ã‚„åã‚ŠãŒã‚ã‚Šã¾ã™" |

#### 6.3.3 æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

| ã‚¿ã‚¤ãƒ— | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|--------|-----------|
| ã‚·ãƒ•ãƒˆä½œæˆæ¡ˆå†… | "ğŸ¯ ã€Œã‚·ãƒ•ãƒˆç”Ÿæˆã€ãƒšãƒ¼ã‚¸ã§ã‚·ãƒ•ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„" |
| ä¼‘æ†©æœªè¨­å®š | "ã“ã®æ—¥ã®ä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã¾ã è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“" |
| ä¼‘æ†©ãƒ«ãƒ¼ãƒ« | "ãƒ•ãƒ«ã‚¿ã‚¤ãƒ è·å“¡: 1æ™‚é–“ Ã— 2å›..." |

### 6.4 ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

#### 6.4.1 ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã®ä¸€æ‹¬é–‹é–‰

- ã€Œã™ã¹ã¦é–‹ãã€ãƒœã‚¿ãƒ³ â†’ `st.session_state.expander_state = True`
- ã€Œã™ã¹ã¦é–‰ã˜ã‚‹ã€ãƒœã‚¿ãƒ³ â†’ `st.session_state.expander_state = False`
- å„ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã¯ `expanded=st.session_state.expander_state` ã§åˆ¶å¾¡

#### 6.4.2 ã‚·ãƒ•ãƒˆå‰Šé™¤ã®å³æ™‚åæ˜ 

1. å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
2. `delete_shift(shift_id)` å®Ÿè¡Œ
3. æˆåŠŸæ™‚: `st.success()` â†’ `st.rerun()`

#### 6.4.3 ä¼‘æ†©å‰²ã‚Šå½“ã¦ã®æµã‚Œ

1. æ—¥ä»˜é¸æŠ
2. è‡ªå‹•å‰²ã‚Šå½“ã¦ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
3. ã‚¹ãƒ”ãƒŠãƒ¼ãªã—ï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
4. æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
5. `st.rerun()` ã§ãƒªãƒ­ãƒ¼ãƒ‰

---

## 7. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ

### 7.1 ä½¿ç”¨ã™ã‚‹é–¢æ•°

| é–¢æ•°å | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ç”¨é€” | å¼•æ•° | æˆ»ã‚Šå€¤ |
|--------|----------|------|------|--------|
| list_shifts | database.py | ã‚·ãƒ•ãƒˆä¸€è¦§å–å¾— | start_date: str, end_date: str | List[dict] |
| delete_shift | database.py | ã‚·ãƒ•ãƒˆå‰Šé™¤ | shift_id: int | bool |
| get_break_schedules | breaks.py | ä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾— | date: str | List[dict] |
| get_employee | database.py | è·å“¡å–å¾— | employee_id: int | Optional[Employee] |
| auto_assign_and_save_breaks | breaks.py | ä¼‘æ†©è‡ªå‹•å‰²ã‚Šå½“ã¦ | date: str, shifts: List[dict] | Tuple[int, bool, List[str]] |
| validate_reception_coverage | breaks.py | ã‚«ãƒãƒ¬ãƒƒã‚¸æ¤œè¨¼ | date: str, shifts: List[dict], breaks: List[dict] | Tuple[bool, List[str]] |
| get_month_range | utils.py | æœˆæ¬¡æœŸé–“å–å¾— | year: int, month: int | Tuple[str, str] |
| get_weekday_jp | utils.py | æ›œæ—¥å–å¾— | date: str | str |
| export_to_excel | utils.py | Excelå‡ºåŠ› | shifts: List[dict], filepath: str | bool |

### 7.2 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

#### ã‚·ãƒ•ãƒˆå‰Šé™¤
```python
delete_shift(shift_id)
# å˜ä¸€DELETEæ–‡ã€è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆ
# CASCADE ã«ã‚ˆã‚Šé–¢é€£ã™ã‚‹ä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚å‰Šé™¤
```

#### ä¼‘æ†©å‰²ã‚Šå½“ã¦
```python
# breaks.pyå†…ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ:
# 1. DELETEï¼ˆè©²å½“æ—¥ã®æ—¢å­˜ä¼‘æ†©ï¼‰
# 2. INSERTï¼ˆæ–°è¦ä¼‘æ†©ï¼‰Ã— Nä»¶
# å„æ“ä½œã¯ç‹¬ç«‹ã—ãŸãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
```

### 7.3 ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§

#### å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„
```sql
-- break_schedules ãƒ†ãƒ¼ãƒ–ãƒ«
FOREIGN KEY (shift_id) REFERENCES shifts(id) ON DELETE CASCADE
```

**å½±éŸ¿**: ã‚·ãƒ•ãƒˆå‰Šé™¤æ™‚ã«é–¢é€£ã™ã‚‹ä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚è‡ªå‹•å‰Šé™¤

---

## 8. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 8.1 ã‚·ãƒ•ãƒˆæœªç™»éŒ²æ™‚ã®å‡¦ç†

```python
shifts = list_shifts(start_date, end_date)
if not shifts:
    st.warning("âš ï¸ ã‚·ãƒ•ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“")
    st.info("ğŸ¯ ã€Œã‚·ãƒ•ãƒˆç”Ÿæˆã€ãƒšãƒ¼ã‚¸ã§ã‚·ãƒ•ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„")
    st.stop()
```

**å‹•ä½œ**: ç”»é¢ã®æç”»ã‚’åœæ­¢ã—ã€è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿è¡¨ç¤º

### 8.2 å‰Šé™¤å¤±æ•—

ã‚·ãƒ•ãƒˆå‰Šé™¤æ™‚ã«`delete_shift()`ãŒFalseã‚’è¿”ã—ãŸå ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„ï¼ˆã‚µã‚¤ãƒ¬ãƒ³ãƒˆï¼‰ã€‚

### 8.3 ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¤±æ•—

```python
if export_to_excel(shifts, filepath):
    st.success("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†")
else:
    st.error("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ")
```

---

## 9. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### 9.1 ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®æœ€é©åŒ–

- **Pandasã®æ´»ç”¨**: ã‚·ãƒ•ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’DataFrameã«å¤‰æ›ã—ã¦é«˜é€Ÿå‡¦ç†
- **ã‚°ãƒ«ãƒ¼ãƒ—åŒ–**: `groupby()`ã§åŠ¹ç‡çš„ãªé›†è¨ˆ
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: DataFrameã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã§é«˜é€ŸæŠ½å‡º

### 9.2 ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®æœ€é©åŒ–

- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¯æœ€å¤§5é€±åˆ†ï¼ˆ35ã‚»ãƒ«ï¼‰ç¨‹åº¦
- ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ã®é–‹é–‰çŠ¶æ…‹ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã§åˆ¶å¾¡
- ã‚°ãƒ©ãƒ•ã¯Plotlyã§æç”»ï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ï¼‰

### 9.3 ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã®æœ€å°åŒ–

- å‰Šé™¤å¾Œã®ã¿`st.rerun()`ã‚’å®Ÿè¡Œ
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´ã¯è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆStreamlitã®æ¨™æº–å‹•ä½œï¼‰

---

## 10. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 10.1 å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

- æ—¥ä»˜é¸æŠ: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸæ—¥ä»˜ã®ã¿é¸æŠå¯èƒ½
- ã‚·ãƒ•ãƒˆID: ãƒœã‚¿ãƒ³ã®keyã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸIDã®ã¿å‰Šé™¤å¯èƒ½

### 10.2 SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ï¼ˆdatabase.pyå†…ã§å®Ÿè£…ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ç›´æ¥SQLæ–‡ã«å«ã‚ãªã„

---

## 11. ãƒ†ã‚¹ãƒˆè¦³ç‚¹

### 11.1 æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | æ“ä½œ | æœŸå¾…çµæœ |
|------------|------|---------|
| ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º | ã‚·ãƒ•ãƒˆã‚ã‚Š | æ—¥ä»˜ã‚»ãƒ«ã«ã‚·ãƒ•ãƒˆæƒ…å ±è¡¨ç¤º |
| ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºï¼ˆæ—¥æ›œï¼‰ | æ—¥æ›œæ—¥ã‚’å«ã‚€ | å®šä¼‘è¡¨ç¤º |
| ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºï¼ˆã‚·ãƒ•ãƒˆãªã—ï¼‰ | ã‚·ãƒ•ãƒˆãªã— | è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| ã‚¨ãƒªã‚¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ | ãƒªãƒå®¤ã®ã¿é¸æŠ | ãƒªãƒå®¤ã®ã‚·ãƒ•ãƒˆã®ã¿è¡¨ç¤º |
| ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼é–‹é–‰ | ã™ã¹ã¦é–‹ãã‚¯ãƒªãƒƒã‚¯ | å…¨ã‚¨ã‚­ã‚¹ãƒ‘ãƒ³ãƒ€ãƒ¼ãŒé–‹ã |
| ã‚·ãƒ•ãƒˆå‰Šé™¤ | å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | ã‚·ãƒ•ãƒˆãŒå‰Šé™¤ã•ã‚Œã€ãƒªãƒ­ãƒ¼ãƒ‰ |
| ä¼‘æ†©è‡ªå‹•å‰²ã‚Šå½“ã¦ | ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | ä¼‘æ†©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒä½œæˆ |
| ã‚«ãƒãƒ¬ãƒƒã‚¸æ¤œè¨¼ | ä¼‘æ†©å‰²ã‚Šå½“ã¦å¾Œ | ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯çµæœè¡¨ç¤º |
| Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | Excelãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ |

### 11.2 UIãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | æ“ä½œ | æœŸå¾…çµæœ |
|------------|------|---------|
| å¹´æœˆç§»å‹• | çŸ¢å°ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | å‰æœˆ/æ¬¡æœˆã«ç§»å‹• |
| ã‚¿ãƒ–åˆ‡æ›¿ | ã‚¿ãƒ–ã‚¯ãƒªãƒƒã‚¯ | ã‚¿ãƒ–å†…å®¹ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ |
| ã‚°ãƒ©ãƒ•è¡¨ç¤º | çµ±è¨ˆã‚¿ãƒ–é¸æŠ | Plotlyã‚°ãƒ©ãƒ•è¡¨ç¤º |
| ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¾Œ | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³è¡¨ç¤º |

### 11.3 ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | æ“ä½œ | æœŸå¾…çµæœ |
|------------|------|---------|
| ã‚·ãƒ•ãƒˆå‰Šé™¤æ™‚ã®ä¼‘æ†©å‰Šé™¤ | ã‚·ãƒ•ãƒˆå‰Šé™¤ | é–¢é€£ã™ã‚‹ä¼‘æ†©ã‚‚è‡ªå‹•å‰Šé™¤ |
| çµ±è¨ˆè¨ˆç®—ã®æ­£ç¢ºæ€§ | - | æ‰‹è¨ˆç®—ã¨ä¸€è‡´ |
| ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢è¨ˆç®— | - | æ¨™æº–åå·®ãŒæ­£ã—ãè¨ˆç®— |

### 11.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | æ¡ä»¶ | æœŸå¾…çµæœ |
|------------|------|---------|
| å¤§é‡ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º | 1000ä»¶ã®ã‚·ãƒ•ãƒˆ | 3ç§’ä»¥å†…ã«è¡¨ç¤º |
| ã‚°ãƒ©ãƒ•æç”» | 30æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ | 1ç§’ä»¥å†…ã«æç”» |
| Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | 1000ä»¶ã®ã‚·ãƒ•ãƒˆ | 5ç§’ä»¥å†…ã«å®Œäº† |

---

## 12. ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### 12.1 æ©Ÿèƒ½è¿½åŠ å€™è£œ

- [ ] ã‚·ãƒ•ãƒˆã®å€‹åˆ¥ç·¨é›†æ©Ÿèƒ½ï¼ˆè·å“¡å¤‰æ›´ã€æ™‚é–“å¤‰æ›´ï¼‰
- [ ] ã‚·ãƒ•ãƒˆã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ç§»å‹•
- [ ] è¤‡æ•°ã‚·ãƒ•ãƒˆã®ä¸€æ‹¬å‰Šé™¤
- [ ] æ—¥ä»˜ç¯„å›²ã§ã®ã‚·ãƒ•ãƒˆä¸€æ‹¬æ“ä½œ
- [ ] ã‚·ãƒ•ãƒˆã®ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
- [ ] ã‚·ãƒ•ãƒˆã®å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] PDFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] ä¼‘æ†©æ™‚é–“ã®æ‰‹å‹•ç·¨é›†

### 12.2 çµ±è¨ˆãƒ»åˆ†ææ©Ÿèƒ½ã®æ‹¡å¼µ

- [ ] æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
- [ ] è·å“¡ã®ç–²åŠ´åº¦åˆ†æï¼ˆé€£ç¶šå‹¤å‹™æ—¥æ•°ç­‰ï¼‰
- [ ] ã‚¹ã‚­ãƒ«ãƒãƒ©ãƒ³ã‚¹ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- [ ] æ™‚é–“å¸¯åˆ¥ã®å……è¶³ç‡ã‚°ãƒ©ãƒ•
- [ ] æ¯”è¼ƒåˆ†æï¼ˆå‰æœˆæ¯”ã€å‰å¹´æ¯”ï¼‰
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½

### 12.3 UI/UXæ”¹å–„å€™è£œ

- [ ] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã¨ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ
- [ ] ã‚·ãƒ•ãƒˆæƒ…å ±ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º
- [ ] è‰²ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½
- [ ] ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ä¿å­˜æ©Ÿèƒ½
- [ ] ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼å¯¾å¿œ
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³æ”¹å–„

---

## 13. åˆ¶ç´„äº‹é …

### 13.1 ç¾åœ¨ã®åˆ¶é™

1. **ç·¨é›†æ©Ÿèƒ½**: ã‚·ãƒ•ãƒˆã®ç·¨é›†ã¯å‰Šé™¤ã®ã¿ï¼ˆå¤‰æ›´ã¯å†ç”ŸæˆãŒå¿…è¦ï¼‰
2. **ä¸€æ‹¬æ“ä½œ**: è¤‡æ•°ã‚·ãƒ•ãƒˆã®åŒæ™‚å‰Šé™¤ã¯ã§ããªã„
3. **å±¥æ­´ç®¡ç†**: å‰Šé™¤ã—ãŸã‚·ãƒ•ãƒˆã®å¾©å…ƒä¸å¯
4. **å°åˆ·æ©Ÿèƒ½**: ãƒ–ãƒ©ã‚¦ã‚¶ã®å°åˆ·æ©Ÿèƒ½ã«ä¾å­˜

### 13.2 ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã®å‰æ

1. **20æ—¥ç· ã‚å›ºå®š**: è¡¨ç¤ºæœŸé–“ã¯20æ—¥ç· ã‚ã§å›ºå®š
2. **Excelãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼ã¯å›ºå®šï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸å¯ï¼‰
3. **ã‚°ãƒ©ãƒ•ã®åˆ¶é™**: Plotlyã®æ¨™æº–æ©Ÿèƒ½ã®ã¿ä½¿ç”¨

---

## 14. ã‚°ãƒ©ãƒ•ãƒ»ãƒãƒ£ãƒ¼ãƒˆã®è©³ç´°

### 14.1 è·å“¡åˆ¥å‹¤å‹™æ—¥æ•°ï¼ˆæ£’ã‚°ãƒ©ãƒ•ï¼‰

**Plotlyè¨­å®š**:
```python
fig = px.bar(
    employee_stats,
    x='employee_name',
    y='å‹¤å‹™æ—¥æ•°',
    title='è·å“¡åˆ¥å‹¤å‹™æ—¥æ•°',
    labels={'employee_name': 'è·å“¡å', 'å‹¤å‹™æ—¥æ•°': 'æ—¥æ•°'}
)
```

**è¡¨ç¤ºå†…å®¹**:
- Xè»¸: è·å“¡å
- Yè»¸: å‹¤å‹™æ—¥æ•°
- ã‚½ãƒ¼ãƒˆ: å‹¤å‹™æ—¥æ•°é™é †

### 14.2 æ—¥åˆ¥ãƒ»æ™‚é–“å¸¯åˆ¥ã‚¹ã‚­ãƒ«åˆè¨ˆï¼ˆæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼‰

**Plotlyè¨­å®š**:
```python
fig2 = px.line(
    time_slot_stats,
    x='æ—¥ä»˜',
    y='ã‚¹ã‚­ãƒ«åˆè¨ˆ',
    color='æ™‚é–“å¸¯',
    title='æ—¥åˆ¥ãƒ»æ™‚é–“å¸¯åˆ¥ã‚¹ã‚­ãƒ«åˆè¨ˆ',
    markers=True
)
```

**è¡¨ç¤ºå†…å®¹**:
- Xè»¸: æ—¥ä»˜
- Yè»¸: ã‚¹ã‚­ãƒ«åˆè¨ˆ
- ç·šã®è‰²: æ™‚é–“å¸¯åˆ¥
- ãƒãƒ¼ã‚«ãƒ¼: å„æ—¥ä»˜ã«ãƒ‰ãƒƒãƒˆè¡¨ç¤º

---

## 15. Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®è©³ç´°

### 15.1 å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

**ãƒ•ã‚¡ã‚¤ãƒ«å**: `shift_{å¹´}{æœˆ}.xlsx`  
**ä¾‹**: `shift_202512.xlsx`

**ä¿å­˜å…ˆ**: `exports/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

### 15.2 å‡ºåŠ›ã‚«ãƒ©ãƒ 

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿ | èª¬æ˜ |
|---------|--------|------|
| æ—¥ä»˜ | date | YYYY-MM-DDå½¢å¼ |
| æ™‚é–“å¸¯ | time_slot_name | æ™‚é–“å¸¯è¡¨ç¤ºå |
| é–‹å§‹æ™‚åˆ» | start_time | HH:MMå½¢å¼ |
| çµ‚äº†æ™‚åˆ» | end_time | HH:MMå½¢å¼ |
| è·å“¡å | employee_name | è·å“¡å |
| ã‚¹ã‚­ãƒ« | skill_score | ã‚¹ã‚­ãƒ«ã‚¹ã‚³ã‚¢ |

### 15.3 å®Ÿè£…

```python
def export_to_excel(shifts, filepath):
    try:
        df = pd.DataFrame(shifts)
        columns = ["date", "time_slot_name", "start_time", "end_time", "employee_name", "skill_score"]
        df = df[columns]
        df.columns = ["æ—¥ä»˜", "æ™‚é–“å¸¯", "é–‹å§‹æ™‚åˆ»", "çµ‚äº†æ™‚åˆ»", "è·å“¡å", "ã‚¹ã‚­ãƒ«"]
        df.to_excel(filepath, index=False, engine="openpyxl")
        return True
    except Exception:
        return False
```

---

## 16. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è¦æ±‚äº‹é …å®šç¾©æ›¸](../docs/REQUIREMENTS.md) - 6. ã‚·ãƒ•ãƒˆè¡¨ç¤ºãƒ»ç·¨é›†
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸](../docs/ARCHITECTURE.md) - ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- [breaks.py å®Ÿè£…](../src/shift_scheduler/breaks.py)
- [utils.py å®Ÿè£…](../src/shift_scheduler/utils.py)

---

**ä½œæˆæ—¥**: 2025å¹´12æœˆ8æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**ä½œæˆè€…**: ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒãƒ¼ãƒ 
