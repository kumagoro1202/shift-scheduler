"""
V3.0ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""
import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent / "src"))

from migration_v3 import (
    check_v3_migration_needed,
    migrate_to_v3,
    backup_v2_data
)


def main():
    print("=" * 60)
    print("ã‚·ãƒ•ãƒˆä½œæˆã‚·ã‚¹ãƒ†ãƒ  V3.0 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
    print("=" * 60)
    print()
    
    # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¿…è¦æ€§ãƒã‚§ãƒƒã‚¯
    if not check_v3_migration_needed():
        print("âœ… æ—¢ã«V3.0ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã§ã™")
        return
    
    # ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
    print("âš ï¸  ã“ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®å¤‰æ›´ã‚’è¡Œã„ã¾ã™:")
    print("  - å‹¤å‹™å½¢æ…‹ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ")
    print("  - æ™‚é–“å¸¯ãƒã‚¹ã‚¿ã‚’å›ºå®šåŒ–")
    print("  - ä¼‘æš‡ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ")
    print("  - æ—¢å­˜ã®å‹¤å‹™å¯å¦ãƒ‡ãƒ¼ã‚¿ã‚’ä¼‘æš‡ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›")
    print()
    response = input("V2.0ã‹ã‚‰V3.0ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™ã‹ï¼Ÿ (yes/no): ")
    if response.lower() not in ['yes', 'y']:
        print("âŒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ")
        return
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    print()
    backup_path = backup_v2_data()
    print()
    
    # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    try:
        migrate_to_v3()
        print()
        print("=" * 60)
        print("âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ")
        print(f"ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {backup_path}")
        print("=" * 60)
        print()
        print("æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:")
        print("  1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¦ãã ã•ã„")
        print("  2. ä¼‘æš‡ç®¡ç†ãƒšãƒ¼ã‚¸ã§è·å“¡ã®ä¼‘æš‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„")
        print("  3. ã‚·ãƒ•ãƒˆç”Ÿæˆã‚’è©¦ã—ã¦å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„")
        print()
    except Exception as e:
        print()
        print("=" * 60)
        print(f"âŒ ã‚¨ãƒ©ãƒ¼: {e}")
        print(f"ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒã—ã¦ãã ã•ã„: {backup_path}")
        print("=" * 60)
        sys.exit(1)


if __name__ == "__main__":
    main()
