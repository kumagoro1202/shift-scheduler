# シフト生成の仕組み - わかりやすい解説

**最終更新日**: 2025年12月10日

---

## このドキュメントについて

このドキュメントは、シフト自動生成システムがどのように動いているのかを、できるだけわかりやすく説明したものです。プログラミングの知識がなくても理解できるように書いています。

---

## 目次

1. [シフト生成の基本的な考え方](#1-シフト生成の基本的な考え方)
2. [誰をどこに配置するか決める仕組み](#2-誰をどこに配置するか決める仕組み)
3. [3つの最適化モードの違い](#3-3つの最適化モードの違い)
4. [よくある質問と回答](#4-よくある質問と回答)
5. [具体的なシフト生成の例](#5-具体的なシフト生成の例)

---

## 1. シフト生成の基本的な考え方

### 1.1 シフト作成で大切にしていること

このシステムは、シフトを作るときに4つのことを大切にしています：

#### ① 公平性 - みんなの勤務日数をできるだけ同じにする

特定の人だけが毎日勤務で、他の人が週に1-2日しか勤務しない、というのは不公平ですよね。このシステムは、できるだけ全員が同じくらいの日数働けるように調整します。

**例**：
- ❌ 悪い例：田中さん週5日、佐藤さん週2日、鈴木さん週1日
- ✅ 良い例：全員が週3-4日程度

#### ② スキルのバランス - 毎日同じくらいのサービス品質を保つ

ある日は経験豊富な人ばかり、別の日は新人ばかり、というのは患者さんにとっても不安です。毎日、経験豊富な人と新しい人がバランスよく配置されるようにします。

**特に受付業務では医事能力を優先**: 保険登録、会計などの医事業務は専門性が高いため、医事能力の高い職員を優先的に配置します。

**例**：
- ❌ 悪い例：月曜日はベテラン3人、火曜日は新人3人
- ✅ 良い例：毎日、ベテラン1-2人と新人1-2人
- ✅ 受付：医事能力の高い職員が必ず1名以上配置

#### ③ ルールを守る - 休暇や勤務時間のルールは絶対

- 休暇を申請している人は絶対に勤務に入れない
- パートタイムの人は勤務時間を超えて働かせない
- リハ室に配置できない人を無理にリハ室に入れない

これらのルールは絶対に守られます。

#### ④ 終日勤務の原則 - 午前だけ・午後だけの勤務は避ける

半休（午前休・午後休）でない限り、午前だけや午後だけの勤務にならないように調整します。朝来た人は基本的に午後も勤務します。

### 1.2 シフトを作る順番

シフトは以下の順番で作られます：

```
1. 最初の日（例：1月1日）から始める
   ↓
2. その日の午前の時間帯を処理
   - リハ室（午前）に2人配置
   - 受付（午前）に4-5人配置
   ↓
3. その日の午後の時間帯を処理
   - リハ室（午後）に2人配置（午前にリハ室にいた人を優先）
   - 受付（午後）に3人配置（午前に受付にいた人を優先）
   ↓
4. 次の日（1月2日）に進む
   ↓
5. 最後の日まで繰り返す
```

**重要なポイント**：
- 1日ずつ順番に処理していきます
- 午前の時間帯を先に処理して、午後はその結果を見ながら処理します
- 午前に勤務した人を午後も優先的に使うことで、「終日勤務」を実現します

---

## 2. 誰をどこに配置するか決める仕組み

### 2.1 配置できるかどうかのチェック

ある職員さんを特定の日・時間帯に配置できるかどうか、以下の順番でチェックします。

#### ステップ1：その日は勤務できる日か？

```
□ その時間帯は診療しているか？
   → 日曜日は休診なので配置できません
   
□ 休暇を取っていないか？
   → 「終日休暇」なら1日中ダメ
   → 「午前休」なら午前の時間帯はダメ
   → 「午後休」なら午後の時間帯はダメ
```

**例**：
- 田中さんが1月15日に「終日休暇」を申請している
  → 1月15日は午前も午後も配置できません

#### ステップ2：勤務時間は大丈夫か？

```
□ 勤務形態の時間内か？
   → パートタイムで「8:30-12:30」の人は午後に配置できません
   
□ 午後勤務が可能な形態か？
   → 「午前のみ」の勤務パターンの人は午後に配置できません
```

**例**：
- 佐藤さんの勤務時間が「8:45-12:45（午前4時間）」
  → 午後15:30からの時間帯には配置できません

#### ステップ3：担当できる業務か？

```
□ 職員タイプは適合しているか？
   → 「受付専任」の人はリハ室に配置できません
   → 「リハ室専任」の人は受付に配置できません
   
□ 必要なスキルを持っているか？
   → リハ室スキルが0の人はリハ室に配置できません
```

**職員タイプ一覧**：

| タイプ | 説明 | リハ室 | 受付 |
|------|------|--------|------|
| TYPE_A | オールラウンダー | ○ | ○ |
| TYPE_B | 受付専任 | × | ○ |
| TYPE_C | リハ室専任（正職員） | ○ | × |
| TYPE_D | リハ室専任（パート） | ○ | × |
| TYPE_E | 受付専任（パート） | × | ○ |
| TYPE_F | 受付専任（時短） | × | ○ |

**例**：
- 鈴木さんは「TYPE_B（受付専任）」
  → リハ室には配置できません、受付のみOK

#### ステップ4：同じ時間に別の場所に入っていないか？

```
□ すでに別の時間帯に配置されていないか？
   → 同じ時間に2カ所には入れません
```

**例**：
- 高橋さんが既に「リハ室（午前）8:30-13:00」に配置されている
  → 重複する「受付（午前）8:30-13:00」には配置できません

### 2.2 スキルスコアとは？

スキルスコアは、その職員さんがその場所・時間帯でどのくらい活躍できるかを数値化したものです。

#### スキルスコアの計算方法

```
【リハ室の場合】
スキルスコア = リハ室スキル + 総合対応力

【受付（午前）の場合】
スキルスコア = 受付午前スキル + 総合対応力

【受付（午後）の場合】
スキルスコア = 受付午後スキル + 総合対応力
```

#### 具体例

田中さんのスキル：
- リハ室スキル：80点
- 受付午前スキル：60点
- 受付午後スキル：50点
- 総合対応力：70点

田中さんを配置したときのスキルスコア：
- リハ室に配置 → 80 + 70 = **150点**
- 受付（午前）に配置 → 60 + 70 = **130点**
- 受付（午後）に配置 → 50 + 70 = **120点**

→ 田中さんはリハ室が得意なので、リハ室に配置すると高いスコアになります

### 2.3 目標スキルスコアとは？

各時間帯には「目標スキルスコア」が設定されています。これは、その時間帯に配置される全員のスキルスコアの合計の目安です。

**例**：受付（午前）に4人配置する場合
- 目標スキルスコア：600点
- 1人あたりの目安：600 ÷ 4 = 150点

システムは、この目標に近づくように職員を選びます。

---

## 3. 3つの最適化モードの違い

シフトを作るとき、3つのモードから選べます。それぞれ「何を一番大切にするか」が違います。

### 3.1 バランスモード（推奨）⭐

**何を大切にする**：勤務日数の公平性とスキルバランスの両方

**どう選ぶか**：
1. まず、勤務日数が少ない人のグループを作る
2. そのグループの中から、スキルスコアが目標に近い人を選ぶ

**具体例**：

受付（午前）に3人配置する場合：

| 職員名 | 勤務回数 | スキルスコア |
|--------|---------|------------|
| 田中さん | 2回 | 180点 |
| 佐藤さん | 2回 | 140点 |
| 鈴木さん | 3回 | 160点 |
| 高橋さん | 3回 | 120点 |
| 伊藤さん | 4回 | 150点 |

目標：450点（1人あたり150点）

**選択の流れ**：

```
【1人目】
・勤務回数が最小（2回）：田中さん、佐藤さん
・目標150点に近いのは佐藤さん（140点）
→ 佐藤さんを選択（勤務回数 2→3回）

【2人目】
・勤務回数が最小（2回）：田中さん
・残り310点、1人あたり155点
・田中さん（180点）を選択（勤務回数 2→3回）
現在合計：320点

【3人目】
・勤務回数が最小（3回）：鈴木さん、高橋さん
・残り130点、1人あたり130点
・目標130点に近いのは高橋さん（120点）
→ 高橋さんを選択（勤務回数 3→4回）

最終結果：佐藤さん、田中さん、高橋さん
合計スキル：140 + 180 + 120 = 440点（目標450点に近い）
```

**良い点**：
- ✅ 勤務回数の少ない人が優先される（公平）
- ✅ スキルバランスも考慮される（品質維持）
- ✅ 実務で最もバランスが良い

**こんな時におすすめ**：
- 通常の運用（ほとんどの場合）
- 公平性も品質も両方大事な時

### 3.2 日数重視モード

**何を大切にする**：勤務日数の公平性だけ

**どう選ぶか**：
勤務日数が少ない人から順番に選ぶ（スキルは見ない）

**具体例**：

同じ状況で日数重視モードを使うと：

```
【1人目】
・勤務回数が最小（2回）：田中さん、佐藤さん
→ 田中さんを選択（スキルは見ない）

【2人目】
・勤務回数が最小（2回）：佐藤さん
→ 佐藤さんを選択

【3人目】
・勤務回数が最小（3回）：鈴木さん、高橋さん
→ 鈴木さんを選択

最終結果：田中さん、佐藤さん、鈴木さん
合計スキル：180 + 140 + 160 = 480点
```

**良い点**：
- ✅ 勤務回数が最も公平に配分される
- ✅ シンプルでわかりやすい

**注意点**：
- ⚠️ スキルバランスが偏る可能性がある

**こんな時におすすめ**：
- 職員間の公平性を最優先したい時
- スキルの差が小さい職場
- 新人を育てたい時期

### 3.3 スキル重視モード

**何を大切にする**：スキルバランスだけ

**どう選ぶか**：
目標スキルスコアに近づくように選ぶ（勤務日数は見ない）

**具体例**：

同じ状況でスキル重視モードを使うと：

```
【1人目】
・目標450点、1人あたり150点
・150点に最も近いのは伊藤さん（150点）
→ 伊藤さんを選択
現在合計：150点

【2人目】
・残り300点、1人あたり150点
・150点に最も近いのは伊藤さんだが既に選択済み
・次に近いのは鈴木さん（160点）
→ 鈴木さんを選択
現在合計：310点

【3人目】
・残り140点、1人あたり140点
・140点に最も近いのは佐藤さん（140点）
→ 佐藤さんを選択

最終結果：伊藤さん、鈴木さん、佐藤さん
合計スキル：150 + 160 + 140 = 450点（目標ぴったり！）
```

**良い点**：
- ✅ スキルバランスが最も良くなる
- ✅ サービス品質が安定する

**注意点**：
- ⚠️ スキルの高い人に勤務が集中しやすい
- ⚠️ 不公平感が出る可能性がある

**こんな時におすすめ**：
- 繁忙期でサービス品質を優先したい時
- スキルの差が大きい職場
- 短期間のシフト作成

### 3.4 モード選択のまとめ

| モード | 公平性 | スキルバランス | おすすめ度 |
|--------|--------|--------------|----------|
| **バランス** ⭐ | ◎ | ◎ | ★★★★★ 通常運用で推奨 |
| 日数重視 | ◎◎ | △ | ★★★☆☆ 公平性を最優先する時 |
| スキル重視 | △ | ◎◎ | ★★★☆☆ 品質を最優先する時 |

**迷ったら「バランスモード」を選んでください！**

---

## 4. よくある質問と回答

### Q1. なぜシフトが作れない時があるの？

**A**: いくつかの理由が考えられます：

#### 理由1：人が足りない

**例**：
- 1月15日（月）の受付（午前）に4人必要
- でも、この日に勤務できる人が3人しかいない
  - 田中さん：終日休暇
  - 佐藤さん：午前休
  - 鈴木さん：受付スキルなし
  - 高橋さん：別の時間帯に配置済み
  
→ 4人必要なのに3人しかいないので、シフトが作れません

**解決方法**：
- 休暇の日程を調整する
- パートタイムの人の勤務時間を延長する
- 新しい職員を追加する

#### 理由2：スキルのある人が足りない

**例**：
- リハ室（午前）に2人必要
- リハ室スキルを持っている人：
  - 田中さん：既に別の時間帯に配置済み
  - 佐藤さん：休暇
  
→ スキルを持つ人が1人しか空いていないので、シフトが作れません

**解決方法**：
- 職員のスキルレベルを上げる（研修など）
- リハ室ができる職員を増やす

#### 理由3：パートタイムのルール違反

**例**：
- リハ室に配置された人が全員パートタイム（TYPE_D）
- ルール：パートタイムだけではダメ、正職員と一緒にする

→ ルール違反なので、シフトが作れません

**解決方法**：
- 正職員を1人以上配置する
- パートタイムの人の一部を他の時間帯に移す

### Q2. 午前だけ・午後だけの勤務はなぜダメなの？

**A**: 「終日勤務の原則」というルールがあるためです。

**理由**：
- 効率性：朝来て昼に帰って、また夕方来るのは非効率
- 公平性：午前だけ・午後だけの人がいると、終日勤務の人が不公平に感じる
- 患者さんへのサービス：同じ人が1日いてくれた方が継続性がある

**例外**：
- 半休（午前休・午後休）を取っている場合はOK
- パートタイムで午前4時間勤務の契約の場合もOK

### Q3. 休憩時間はどうやって決まるの？

**A**: シフトが決まった後、自動的に休憩時間が割り当てられます。

**基本ルール**：
1. 受付窓口には常に必要な人数を残す（午前4-5名、午後3名）
2. 正職員は基本的に2時間連続で休憩（忙しい日は分割も可）
3. パートタイム（4時間勤務）は休憩なし

**休憩時間の優先枠**：
- 11:00-12:00（1時間）
- 12:00-13:00（1時間）
- 13:00-14:00（1時間）

**例**：受付に5人配置されている場合
- 必要人数：4-5名なので、最低4名は窓口にいる必要がある
- 同時に休憩できる人数：5 - 4 = 1人まで

```
11:00-12:00：田中さんが休憩（窓口に4人残る）
12:00-13:00：佐藤さんが休憩（窓口に4人残る）
13:00-14:00：鈴木さんが休憩（窓口に4人残る）
```

### Q4. スキルスコアはどうやって設定すればいい？

**A**: 以下の目安を参考にしてください：

#### スキルレベルの目安

| レベル | 点数 | 説明 | 例 |
|--------|------|------|-----|
| 初心者 | 0-30点 | まだ一人では難しい | 入職1ヶ月 |
| 見習い | 40-60点 | 基本的なことはできる | 入職3-6ヶ月 |
| 一人前 | 70-90点 | 問題なく対応できる | 入職1-2年 |
| ベテラン | 100点 | 指導もできる | 入職3年以上 |

#### 総合対応力の目安

| レベル | 点数 | 説明 |
|--------|------|------|
| 低い | 30-50点 | トラブル対応が苦手 |
| 普通 | 60-80点 | 通常の対応はOK |
| 高い | 90-100点 | 何でも対応できる |

**設定例**：

田中さん（入職3年のベテラン）：
- リハ室スキル：100点（リハ室のベテラン）
- 受付午前スキル：80点（受付も対応できる）
- 受付午後スキル：70点（午後は少し苦手）
- 総合対応力：90点（何でも対応できる）

佐藤さん（入職6ヶ月）：
- リハ室スキル：0点（リハ室の資格なし）
- 受付午前スキル：50点（基本的なことはできる）
- 受付午後スキル：40点（まだ慣れていない）
- 総合対応力：60点（通常の対応はOK）

### Q5. シフトを手動で調整できる？

**A**: はい、自動生成後に手動で調整できます。

**調整できること**：
- 職員の入れ替え
- 休憩時間の変更
- 追加の職員配置

**調整の流れ**：
1. 自動生成でベースのシフトを作る
2. シフト表示画面で確認
3. 必要に応じて手動で調整
4. Excel出力して完成

---

## 5. 具体的なシフト生成の例

### 5.1 1週間のシフトを作る例

**状況**：
- 期間：1月15日（月）〜1月21日（日）
- 職員：5名
- モード：バランスモード

#### 職員情報

| 職員名 | タイプ | リハ室 | 受付午前 | 受付午後 | 総合 |
|--------|--------|--------|----------|----------|------|
| 田中さん | TYPE_A | 90 | 80 | 70 | 85 |
| 佐藤さん | TYPE_B | - | 70 | 60 | 75 |
| 鈴木さん | TYPE_A | 60 | 90 | 85 | 80 |
| 高橋さん | TYPE_C | 85 | - | - | 70 |
| 伊藤さん | TYPE_B | - | 60 | 55 | 65 |

TYPE_A：リハ室・受付両方OK、TYPE_B：受付のみ、TYPE_C：リハ室のみ

#### 休暇申請

- 1月17日（水）：佐藤さん終日休暇
- 1月19日（金）：田中さん午前休

#### 1月15日（月）のシフト生成

**月曜日の時間帯**：
- リハ室（午前）：2名必要
- 受付（午前）：4名必要
- リハ室（午後）：2名必要
- 受付（午後）：3名必要

**処理の流れ**：

##### ステップ1：リハ室（午前）に2名配置

勤務可能な職員（リハ室スキルあり）：
- 田中さん（スキル 90+85=175点、勤務0回）
- 鈴木さん（スキル 60+80=140点、勤務0回）
- 高橋さん（スキル 85+70=155点、勤務0回）

バランスモードで選択：
1. 全員勤務0回なので、スキルで選択
2. 目標スコア：2名×150点=300点
3. 1人あたり150点が目安
4. 150点に近いのは高橋さん（155点）→ 選択
5. 残り145点、150点に近いのは鈴木さん（140点）→ 選択

**結果**：高橋さん、鈴木さん

##### ステップ2：受付（午前）に4名配置

勤務可能な職員（受付スキルあり）：
- 田中さん（スキル 80+85=165点、勤務0回）
- 佐藤さん（スキル 70+75=145点、勤務0回）
- 鈴木さん（既に配置済みで時間が重複するため除外）
- 伊藤さん（スキル 60+65=125点、勤務0回）

→ 3名しかいない！でもリハ室と受付は場所が違うので...

実際は鈴木さんも配置可能（TYPE_Aは両方OK）：
- 田中さん（165点、勤務0回）
- 佐藤さん（145点、勤務0回）
- 鈴木さん（90+80=170点、勤務1回）
- 伊藤さん（125点、勤務0回）

バランスモードで選択：
1. 勤務0回：田中さん、佐藤さん、伊藤さん
2. この3名から選択
3. 目標600点（1人あたり150点）
4. 田中さん（165点）、佐藤さん（145点）、伊藤さん（125点）を選択
5. 現在435点、残り165点
6. 勤務1回の鈴木さん（170点）を選択

**結果**：田中さん、佐藤さん、伊藤さん、鈴木さん

##### ステップ3：リハ室（午後）に2名配置

午前にリハ室にいた人：高橋さん、鈴木さん

この2名を優先的に選択：
- 高橋さん（勤務1回）
- 鈴木さん（勤務2回）

**結果**：高橋さん、鈴木さん（終日勤務）

##### ステップ4：受付（午後）に3名配置

午前に受付にいた人：田中さん、佐藤さん、伊藤さん、鈴木さん

鈴木さんは既にリハ室（午後）に配置済みなので除外

残り：田中さん、佐藤さん、伊藤さん（3名ちょうど）

**結果**：田中さん、佐藤さん、伊藤さん（終日勤務）

#### 1月15日（月）の最終シフト

| 時間帯 | 配置された職員 |
|--------|--------------|
| リハ室（午前） | 高橋さん、鈴木さん |
| 受付（午前） | 田中さん、佐藤さん、伊藤さん、鈴木さん |
| リハ室（午後） | 高橋さん、鈴木さん |
| 受付（午後） | 田中さん、佐藤さん、伊藤さん |

**勤務カウント更新**：
- 田中さん：0 → 1回
- 佐藤さん：0 → 1回
- 鈴木さん：0 → 1回
- 高橋さん：0 → 1回
- 伊藤さん：0 → 1回

（全員1日勤務）

### 5.2 翌日以降の処理

#### 1月16日（火）

前日の勤務カウントを引き継ぎ：全員1回

同じ流れで処理すると、勤務回数を考慮して配置されます。

#### 1月17日（水）- 佐藤さん休暇

佐藤さんは終日休暇なので、配置候補から自動的に除外されます。
他の4名で必要人数を確保します。

#### 1月19日（金）- 田中さん午前休

田中さんは午前の時間帯には配置されませんが、午後は配置可能です。

**リハ室（午前）**：田中さんは除外
**受付（午前）**：田中さんは除外
**リハ室（午後）**：田中さん配置可能
**受付（午後）**：田中さん配置可能

---

## まとめ

### シフト生成システムの特徴

1. **自動で公平なシフトを作成**: 勤務日数を均等に配分
2. **スキルバランスを考慮**: 毎日同じくらいのサービス品質
3. **ルールを厳格に守る**: 休暇や勤務時間の制約は絶対遵守
4. **柔軟な最適化**: 3つのモードから選択可能
5. **終日勤務を実現**: 午前・午後を分断しない配置

### 使い方のコツ

1. **通常は「バランスモード」を使用**: 最もバランスが良い
2. **スキルレベルを適切に設定**: 実際の能力を反映させる
3. **休暇は早めに登録**: シフト生成前に全て登録する
4. **エラーが出たら原因を確認**: システムが詳しく教えてくれる
5. **自動生成後に微調整**: 必要に応じて手動で調整

### 困った時は

- エラーメッセージをよく読む（原因が詳しく書いてあります）
- 職員数や休暇を調整してみる
- 違う最適化モードを試してみる
- それでもダメなら手動でシフトを組む

---

**このドキュメントで分からないことがあれば、システム管理者に相談してください。**
