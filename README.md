# シフト管理システム V3.0

小規模施設（5〜10名程度）向けの高度な自動シフト最適化システムです。

## 🌟 主な機能

- 🏖️ **休暇管理の簡素化**: 日付単位で休暇を登録（終日/午前/午後）
- 📅 **診療時間の固定化**: システム定義の診療時間で運用が簡単
- 💼 **勤務形態マスタ**: 早番・中番・遅番など柔軟な勤務形態管理
- ✅ **自動判定**: 休暇未登録の日は勤務形態に応じて自動的に勤務可能
- 🎯 **高度な最適化**: 4項目スキルスコアと職員タイプを考慮
- ☕ **休憩時間管理**: 自動休憩割り当てと窓口カバレッジ検証

## 特徴

- 💻 **ローカル実行**: サーバー不要、PC上で完結
- 📊 **詳細な視覚化**: グラフや統計でシフトバランスを分析
- 📥 **Excel出力**: 印刷・配布用にExcel形式で出力可能
- ⚡ **簡単操作**: ブラウザベースの直感的なUI

## クイックスタート

### 初回セットアップ

```powershell
# 依存パッケージのインストール
pip install -r requirements.txt

# サンプルデータの投入（任意）
python scripts/init_sample_data.py

# アプリケーションの起動
streamlit run main.py
```

ブラウザが自動的に開き、`http://localhost:8501` でアプリケーションにアクセスできます。

## 機能一覧

| 機能 | 説明 |
|-----|------|
| 👥 職員管理 | 職員タイプ、4項目スキルスコア、勤務形態の詳細管理 |
| 🏖️ 休暇管理 | 終日休暇・午前休・午後休を日付単位で登録 |
| 🎯 シフト生成 | 3つの最適化モードによる自動シフト作成 |
| ☕ 休憩管理 | 自動休憩時間割り当てと窓口カバレッジ検証 |
| 📋 シフト表示 | カレンダー表示、休憩時間、統計分析、Excel出力 |

## 診療スケジュール（V3.0固定）

| 曜日 | 午前 | 午後 |
|-----|------|------|
| 月 | 09:00-12:30 | 15:30-18:30 |
| 火 | 09:00-12:30 | 15:30-18:30 |
| 水 | 09:00-12:30 | 15:30-17:30 |
| 木 | 09:00-12:30 | 休診 |
| 金 | 09:00-12:30 | 15:30-18:30 |
| 土 | 09:00-13:30 | 休診 |
| 日 | 休診 | 休診 |

## V3.0 勤務形態マスタ

| 勤務形態 | 勤務時間 | 午後勤務 | 対象 |
|---------|---------|---------|------|
| フルタイム（早番） | 08:30-18:30 | ✅ | 正職員 |
| フルタイム（中番） | 08:45-18:45 | ✅ | 正職員 |
| フルタイム（遅番） | 09:00-19:00 | ✅ | 正職員 |
| 時短勤務 | 08:45-16:45 | ❌ | 正職員 |
| パート午前 | 08:45-12:45 | ❌ | パート |
| パート午前延長 | 08:45-13:45 | ❌ | パート |

### 職員タイプ

- **TYPE_A**: リハ室・受付両方可能（最も柔軟）
- **TYPE_B**: 受付のみ
- **TYPE_C**: リハ室のみ（正職員）
- **TYPE_D**: リハ室のみ（パート、特殊ルール適用）

### スキルスコア（4項目）

- **リハ室スキル**: リハビリ室での業務能力（0-100）
- **受付午前スキル**: 受付業務（午前）の能力（0-100）
- **受付午後スキル**: 受付業務（午後）の能力（0-100）
- **総合対応力**: 全般的な対応能力（0-100）

### 最適化モード

- **バランス**: 勤務回数とスキルの両方を考慮（推奨）
- **スキル重視**: 目標スキルスコアへの近似を優先
- **日数重視**: 勤務回数の均等化を優先

### 休憩ローテーション

- フルタイム職員: 1時間×2回
- 時短勤務職員: 1時間×1回
- パート職員: 休憩なし
- 受付窓口には常に2名以上が実働状態を保証

## システム要件

- **総合対応力**: 全般的な対応能力（0-100）

## システム要件

- **OS**: Windows 10/11
- **メモリ**: 4GB以上推奨
- **ディスク**: 500MB以上の空き容量
- **ブラウザ**: Chrome, Edge, Firefox など

## 技術スタック

- **言語**: Python 3.11+
- **フレームワーク**: Streamlit 1.28+
- **データベース**: SQLite 3.x
- **最適化エンジン**: PuLP 2.7+
- **可視化**: Plotly, Pandas

## プロジェクト構成

```text
shift-scheduler/
├── main.py                 # アプリケーションエントリーポイント
├── requirements.txt        # Python依存関係
├── README.md               # このファイル
├── src/                    # ソースコード
│   ├── database.py         # データベース操作（V3.0完全版）
│   ├── optimizer.py        # シフト最適化エンジン
│   ├── availability_checker.py  # 勤務可否判定
│   ├── break_scheduler.py  # 休憩時間自動割り当て
│   └── utils.py            # ユーティリティ関数
├── pages/                  # Streamlitページ
│   ├── 1_👥_職員管理.py    # 職員管理（勤務形態選択）
│   ├── 2_🏖️_休暇管理.py    # 休暇管理（日付単位休暇登録）
│   ├── 3_🎯_シフト生成.py   # シフト生成（最適化モード選択）
│   └── 4_📋_シフト表示.py   # シフト表示（休憩時間表示）
├── docs/                   # ドキュメント
│   ├── REQUIREMENTS.md     # 要求事項定義書（V3.0統合版）
│   ├── ARCHITECTURE.md     # システム設計書（V3.0対応）
│   └── USER_GUIDE.md       # 利用ガイド（V3.0対応）
├── scripts/                # ユーティリティスクリプト
│   ├── run.bat             # 起動用バッチファイル（Windows）
│   ├── reset_db.bat        # データベースリセット（Windows）
│   ├── init_sample_data.py # サンプルデータ投入
│   ├── launcher.py         # PyInstaller用ランチャー
│   └── build.spec          # PyInstallerビルド設定
├── tests/                  # テストファイル
│   ├── test_availability_v3.py  # 勤務可否テスト
│   ├── test_break_scheduler.py  # 休憩スケジューラーテスト
│   └── test_generate.py    # シフト生成テスト
├── data/                   # データベース（自動生成）
│   └── shift.db            # SQLiteデータベース
└── build/                  # ビルド成果物
```

## ドキュメント

- **[要求事項定義書](docs/REQUIREMENTS.md)**: システムの詳細仕様（V3.0最新版）
- **[システム設計書](docs/ARCHITECTURE.md)**: アーキテクチャと設計思想（V3.0対応）
- **[利用ガイド](docs/USER_GUIDE.md)**: 詳細な操作方法（V3.0対応）

## 実行可能ファイルのビルド

開発者向け: `.exe` ファイルを作成する場合

```powershell
# PyInstallerのインストール
pip install pyinstaller

# ビルド実行
pyinstaller scripts/build.spec

# 出力先: dist/shift_system/shift_system.exe
```

## バックアップ

データベースファイル (`data/shift.db`) を定期的にバックアップしてください:

```powershell
Copy-Item data/shift.db "shift_backup_$(Get-Date -Format 'yyyyMMdd').db"
```

## ライセンス

このソフトウェアは社内利用を目的としています。

## サポート

システムに関するご質問は、システム管理者までお問い合わせください。

---

**Version**: 3.0.0  
**最終更新日**: 2025年11月28日
